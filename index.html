<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–µ—â–µ–±—Ä–æ—Å –û–Ω–ª–∞–π–Ω</title>
<style>
body { font-family: Arial; background: linear-gradient(135deg,#8e2de2,#4a00e0); color: white; text-align: center; padding: 20px; }
h1 { font-size: 3em; text-shadow: 2px 2px 5px #000; }
.characters { display:flex; justify-content:center; gap:30px; margin-bottom:20px; }
.character-box { text-align:center; position: relative; }
.character-box img { width:150px; height:150px; object-fit:cover; border-radius:15px; border:3px solid transparent; cursor:pointer; }
input.name-input { margin-bottom:5px; padding:5px; border-radius:5px; border:none; text-align:center; }
button { padding:15px 30px; font-size:18px; border:none; border-radius:15px; cursor:pointer; background:yellow; color:black; font-weight:bold; box-shadow:0 5px 15px rgba(0,0,0,0.3); margin:5px;}
#chat { max-width:600px; margin:20px auto; background:rgba(255,255,255,0.9); color:black; border-radius:15px; padding:15px; height:250px; overflow-y:auto; box-shadow:0 5px 20px rgba(0,0,0,0.5); }
.hand { position:absolute; width:100px; transform:translate(-50%,-50%) rotate(-45deg); display:none; z-index:10; }
.flash { position:absolute; width:150px; height:150px; border-radius:50%; background: radial-gradient(circle, rgba(255,255,0,0.8) 0%, rgba(255,0,255,0) 70%); display:none; z-index:20;}
.signal { font-size:2em; margin:15px;}
</style>
</head>
<body>

<h1>–õ–µ—â–µ–±—Ä–æ—Å –û–Ω–ª–∞–π–Ω</h1>

<div class="characters">
  <div class="character-box">
    <input class="name-input" id="leftName" placeholder="–ò–º—è –õ–µ–≤–æ–≥–æ">
    <input type="file" id="leftUpload"><br>
    <img id="leftImg" src="" alt="–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ">
    <div id="leftScore">–û—á–∫–∏: 0</div>
  </div>
  <div class="character-box">
    <input class="name-input" id="rightName" placeholder="–ò–º—è –ü—Ä–∞–≤–æ–≥–æ">
    <input type="file" id="rightUpload"><br>
    <img id="rightImg" src="" alt="–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ">
    <div id="rightScore">–û—á–∫–∏: 0</div>
  </div>
</div>

<div class="signal" id="signal">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥"</div>
<button id="startBtn">–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥</button>
<button id="leftHit">–õ–µ–≤—ã–π —É–¥–∞—Ä</button>
<button id="rightHit">–ü—Ä–∞–≤—ã–π —É–¥–∞—Ä</button>

<div id="chat"></div>
<img id="handImg" src="https://i.imgur.com/FfHR6Sl.png" class="hand"/>
<div id="flash" class="flash"></div>
<audio id="slapSound" src="https://www.soundjay.com/human/sounds/slap-01.mp3"></audio>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// === Firebase config ===
const firebaseConfig = {
  apiKey: "AIzaSyBFK98q0ApvdD7H45VV7hyIrjx0l8N5pnI",
  authDomain: "leshebros.firebaseapp.com",
  projectId: "leshebros",
  storageBucket: "leshebros.firebasestorage.app",
  messagingSenderId: "92936380725",
  appId: "1:92936380725:web:9c6a70acc2cb3c3db9ec7c",
  measurementId: "G-HMXVSDQLP7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// === DOM —ç–ª–µ–º–µ–Ω—Ç—ã ===
const leftImg=document.getElementById('leftImg');
const rightImg=document.getElementById('rightImg');
const leftUpload=document.getElementById('leftUpload');
const rightUpload=document.getElementById('rightUpload');
const leftNameInput=document.getElementById('leftName');
const rightNameInput=document.getElementById('rightName');
const slapSound=document.getElementById('slapSound');
const handImg=document.getElementById('handImg');
const flash=document.getElementById('flash');
const chat=document.getElementById('chat');
const leftScoreDisplay=document.getElementById('leftScore');
const rightScoreDisplay=document.getElementById('rightScore');
const startBtn=document.getElementById('startBtn');
const leftHit=document.getElementById('leftHit');
const rightHit=document.getElementById('rightHit');
const signal=document.getElementById('signal');

// === –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
let leftScore=0,rightScore=0;
let consecutiveLeft=0,consecutiveRight=0;
let roundActive=false;

// === –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ===
leftUpload.addEventListener('change',e=>{leftImg.src=URL.createObjectURL(e.target.files[0]);});
rightUpload.addEventListener('change',e=>{rightImg.src=URL.createObjectURL(e.target.files[0]);});

// === –ö–æ–º–Ω–∞—Ç–∞ Firebase ===
let roomId = "room1";
const roomRef = db.ref("rooms/"+roomId);

// === –ù–∞—á–∞–ª–æ —Ä–∞—É–Ω–¥–∞ ===
startBtn.addEventListener('click',()=>{
    signal.textContent="–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å...";
    roundActive=false;
    roomRef.update({lastHit:null}); // –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞
    setTimeout(()=>{
        signal.textContent="–£–¥–∞—Ä—å! üèÅ";
        roundActive=true;
    }, Math.random()*2000+1000);
});

// === –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã ===
roomRef.on("value", snapshot=>{
    const data = snapshot.val();
    if(!data || !data.lastHit) return;
    performHit(data.lastHit === "left");
});

// === –§—É–Ω–∫—Ü–∏—è —É–¥–∞—Ä–∞ ===
const zoomerPhrases=["—â–æ–≤–µ–ª—å","–ø–∏–∫–º–∏","–∞–±–∞—é–¥–Ω–æ","—Ç—É–Ω–≥ —Ç—É–Ω–≥ —Å–∞—Ö—É—Ä","–æ–π –æ–π —Ö–∞–ª–µ–ø–∞","–∫–∏—Å–∏ –∫–∏—Å–∏ –º—è—É –º—è—É"];
const normalPhrases=["—Ç—ã —á–æ –µ–±–ª–∞–Ω?","—Ç—ã –≤–∞—â–µ –µ–±–∞–Ω—É–ª—Å—è?","–Ω–∞ –Ω–∞—Ö—É–π?","–ª—Å–Ω—ã–π –º—É—Å–æ—Ä","—É–±–ª—é–¥–æ–∫ —Å–ª–∞–±—ã–π","–∏–¥–∏ –Ω–∞—Ö—É–π","–¥–µ–±–∏–ª"];

function performHit(isLeft){
    if(!roundActive) return;
    if(!leftImg.src || !rightImg.src) return;

    slapSound.currentTime=0; slapSound.play();

    const leftRect=leftImg.getBoundingClientRect();
    const rightRect=rightImg.getBoundingClientRect();
    const leftTop=leftRect.top+leftRect.height/2;
    const rightTop=rightRect.top+rightRect.height/2;

    let startX,endX,topY,phrase,isFatality=false;

    if(isLeft){
        startX=leftRect.right+leftRect.width*0.1;
        endX=rightRect.left;
        topY=leftTop;
        leftScore++; consecutiveLeft++; consecutiveRight=0;
        phrase=`${leftNameInput.value||"–õ–µ–≤—ã–π"}: ${zoomerPhrases[Math.floor(Math.random()*zoomerPhrases.length)]}`;
        if(consecutiveLeft>=3){
            isFatality=true;
            phrase=`${leftNameInput.value||"–õ–µ–≤—ã–π"} —Å–æ–≤–µ—Ä—à–∞–µ—Ç –§–ê–¢–ê–õ–ò–¢–ò! üí•üíÄ`;
            leftScore+=5; consecutiveLeft=0;
        }
    } else {
        startX=rightRect.left;
        endX=leftRect.right+leftRect.width*0.1;
        topY=rightTop;
        rightScore++; consecutiveRight++; consecutiveLeft=0;
        phrase=`${rightNameInput.value||"–ü—Ä–∞–≤—ã–π"}: ${normalPhrases[Math.floor(Math.random()*normalPhrases.length)]}`;
        if(consecutiveRight>=3){
            isFatality=true;
            phrase=`${rightNameInput.value||"–ü—Ä–∞–≤—ã–π"} —Å–æ–≤–µ—Ä—à–∞–µ—Ç –§–ê–¢–ê–õ–ò–¢–ò! üí•üíÄ`;
            rightScore+=5; consecutiveRight=0;
        }
    }

    chat.innerHTML+=`<p>${phrase}</p>`; chat.scrollTop=chat.scrollHeight;
    leftScoreDisplay.textContent=`–û—á–∫–∏: ${leftScore}`;
    rightScoreDisplay.textContent=`–û—á–∫–∏: ${rightScore}`;

    handImg.style.top=topY+"px";
    handImg.style.left=startX+"px";
    handImg.style.display="block";

    handImg.animate([
        { transform:"translate(0,-50%) rotate(-45deg) scale(0)" },
        { transform:`translate(${endX-startX}px,-50%) rotate(-45deg) scale(1.2)` },
        { transform:`translate(${endX-startX}px,-50%) rotate(-45deg) scale(1)` }
    ],{duration:400,fill:"forwards"});

    if(isFatality){
        flash.style.top=topY-75+"px";
        flash.style.left=endX-75+"px";
        flash.style.display="block";
        flash.animate([{ transform:"scale(0.5)", opacity:1 },{ transform:"scale(1.5)", opacity:0 }],
            { duration:600, fill:"forwards"});
        setTimeout(()=>{flash.style.display="none";},600);
    }

    roundActive=false;
    signal.textContent="–ù–∞–∂–º–∏—Ç–µ '–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥' –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–¥–∞—Ä–∞";
}

// === –û—Ç–ø—Ä–∞–≤–∫–∞ —É–¥–∞—Ä–∞ –Ω–∞ Firebase ===
leftHit.addEventListener('click',()=>{ roomRef.update({lastHit:"left"}); });
rightHit.addEventListener('click',()=>{ roomRef.update({lastHit:"right"}); });

</script>
</body>
</html>
