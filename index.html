<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–µ—â–µ–±—Ä–æ—Å –û–Ω–ª–∞–π–Ω —Å –õ–æ–±–±–∏</title>
<style>
body { font-family: Arial; background: linear-gradient(135deg,#8e2de2,#4a00e0); color: white; text-align: center; padding: 20px; }
h1 { font-size: 3em; text-shadow: 2px 2px 5px #000; margin-bottom: 20px; }
.characters { display:flex; justify-content:center; gap:30px; margin-bottom:20px; }
.character-box { text-align:center; position: relative; }
.character-box img { width:150px; height:150px; object-fit:cover; border-radius:15px; border:3px solid transparent; cursor:pointer; }
input.name-input { margin-bottom:5px; padding:5px; border-radius:5px; border:none; text-align:center; }
button { padding:10px 20px; margin:5px; font-size:16px; border-radius:10px; border:none; cursor:pointer; font-weight:bold; }
#chat { max-width:600px; margin:20px auto; background:rgba(255,255,255,0.9); color:black; border-radius:15px; padding:15px; height:200px; overflow-y:auto; box-shadow:0 5px 20px rgba(0,0,0,0.5); }
.hand { position:absolute; width:100px; transform:translate(-50%,-50%) rotate(-45deg); display:none; z-index:10; }
.signal { font-size:1.5em; margin:10px; }
</style>
</head>
<body>

<h1>–õ–µ—â–µ–±—Ä–æ—Å –û–Ω–ª–∞–π–Ω —Å –õ–æ–±–±–∏</h1>

<div>
    <button id="createRoom">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
    <input id="joinCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">
    <button id="joinRoom">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
</div>

<div class="signal" id="roomInfo"></div>

<div class="characters" id="gameArea" style="display:none;">
  <div class="character-box">
    <input class="name-input" id="leftName" placeholder="–ò–º—è –õ–µ–≤–æ–≥–æ">
    <input type="file" id="leftUpload"><br>
    <img id="leftImg" src="" alt="–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ">
    <div id="leftScore">–û—á–∫–∏: 0</div>
  </div>
  <div class="character-box">
    <input class="name-input" id="rightName" placeholder="–ò–º—è –ü—Ä–∞–≤–æ–≥–æ">
    <input type="file" id="rightUpload"><br>
    <img id="rightImg" src="" alt="–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ">
    <div id="rightScore">–û—á–∫–∏: 0</div>
  </div>
</div>

<div>
    <button id="startBtn" style="display:none;">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    <button id="leftHit" style="display:none;">–õ–µ–≤—ã–π —É–¥–∞—Ä</button>
    <button id="rightHit" style="display:none;">–ü—Ä–∞–≤—ã–π —É–¥–∞—Ä</button>
</div>

<div id="chat"></div>
<img id="handImg" src="https://i.imgur.com/FfHR6Sl.png" class="hand"/>
<audio id="slapSound" src="https://www.soundjay.com/human/sounds/slap-01.mp3"></audio>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// === Firebase config ===
const firebaseConfig = {
  apiKey: "AIzaSyBFK98q0ApvdD7H45VV7hyIrjx0l8N5pnI",
  authDomain: "leshebros.firebaseapp.com",
  projectId: "leshebros",
  storageBucket: "leshebros.firebasestorage.app",
  messagingSenderId: "92936380725",
  appId: "1:92936380725:web:9c6a70acc2cb3c3db9ec7c",
  measurementId: "G-HMXVSDQLP7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// === DOM —ç–ª–µ–º–µ–Ω—Ç—ã ===
const createRoom=document.getElementById('createRoom');
const joinRoomBtn=document.getElementById('joinRoom');
const joinCodeInput=document.getElementById('joinCode');
const roomInfo=document.getElementById('roomInfo');

const leftImg=document.getElementById('leftImg');
const rightImg=document.getElementById('rightImg');
const leftUpload=document.getElementById('leftUpload');
const rightUpload=document.getElementById('rightUpload');
const leftNameInput=document.getElementById('leftName');
const rightNameInput=document.getElementById('rightName');
const leftScoreDisplay=document.getElementById('leftScore');
const rightScoreDisplay=document.getElementById('rightScore');
const slapSound=document.getElementById('slapSound');
const handImg=document.getElementById('handImg');
const chat=document.getElementById('chat');

const gameArea=document.getElementById('gameArea');
const startBtn=document.getElementById('startBtn');
const leftHit=document.getElementById('leftHit');
const rightHit=document.getElementById('rightHit');

const zoomerPhrases=["—â–æ–≤–µ–ª—å","–ø–∏–∫–º–∏","–∞–±–∞—é–¥–Ω–æ","—Ç—É–Ω–≥ —Ç—É–Ω–≥ —Å–∞—Ö—É—Ä","–æ–π –æ–π —Ö–∞–ª–µ–ø–∞","–∫–∏—Å–∏ –∫–∏—Å–∏ –º—è—É –º—è—É"];
const normalPhrases=["—Ç—ã —á–æ –µ–±–ª–∞–Ω?","—Ç—ã –≤–∞—â–µ –µ–±–∞–Ω—É–ª—Å—è?","–Ω–∞ –Ω–∞—Ö—É–π?","–ª—Å–Ω—ã–π –º—É—Å–æ—Ä","—É–±–ª—é–¥–æ–∫ —Å–ª–∞–±—ã–π"];

let leftScore=0,rightScore=0;
let consecutiveLeft=0,consecutiveRight=0;
let roundActive=false;
let roomRef=null;

// === –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ===
leftUpload.addEventListener('change',e=>{leftImg.src=URL.createObjectURL(e.target.files[0]);});
rightUpload.addEventListener('change',e=>{rightImg.src=URL.createObjectURL(e.target.files[0]);});

// === –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ ===
function generateRoomCode(){ return Math.random().toString(36).substring(2,8).toUpperCase(); }

createRoom.addEventListener('click',()=>{
    const code=generateRoomCode();
    roomRef=db.ref('rooms/'+code);
    roomRef.set({players:{},leftScore:0,rightScore:0,lastHit:null,roundActive:false});
    roomInfo.textContent="–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞! –ö–æ–¥: "+code;
    setupGameUI();
});

joinRoomBtn.addEventListener('click',()=>{
    const code=joinCodeInput.value.trim().toUpperCase();
    if(!code) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã!");
    roomRef=db.ref('rooms/'+code);
    roomRef.once('value',snapshot=>{
        if(snapshot.exists()){
            roomInfo.textContent="–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –∫–æ–º–Ω–∞—Ç–µ: "+code;
            setupGameUI();
        } else alert("–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
    });
});

// === –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –ø–∞–Ω–µ–ª—å ===
function setupGameUI(){
    gameArea.style.display="flex";
    startBtn.style.display="inline-block";
    leftHit.style.display="inline-block";
    rightHit.style.display="inline-block";
}

// === –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑) ===
startBtn.addEventListener('click',()=>{
    startBtn.style.display='none'; // –ø—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–≤—Å–µ–≥–¥–∞
    roundActive=false;
    roomRef.update({lastHit:null,roundActive:true});
    setTimeout(()=>{ roundActive=true; }, Math.random()*2000+1000);
});

// === –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ Firebase ===
roomRef?.on("value",snapshot=>{
    const data=snapshot.val();
    if(!data || !data.lastHit) return;
    performHit(data.lastHit==='left');
});

// === –£–¥–∞—Ä ===
function performHit(isLeft){
    if(!roundActive) return;
    slapSound.currentTime=0; slapSound.play();

    const leftRect=leftImg.getBoundingClientRect();
    const rightRect=rightImg.getBoundingClientRect();
    const leftTop=leftRect.top+leftRect.height/2;
    const rightTop=rightRect.top+rightRect.height/2;

    let startX,endX,topY,phrase,isFatality=false;

    if(isLeft){
        startX=leftRect.right+leftRect.width*0.1;
        endX=rightRect.left;
        topY=leftTop;
        leftScore++; consecutiveLeft++; consecutiveRight=0;
        phrase=`${leftNameInput.value||"–õ–µ–≤—ã–π"}: ${zoomerPhrases[Math.floor(Math.random()*zoomerPhrases.length)]}`;
        if(consecutiveLeft>=3){ isFatality=true; phrase=`${leftNameInput.value||"–õ–µ–≤—ã–π"} —Å–æ–≤–µ—Ä—à–∞–µ—Ç –§–ê–¢–ê–õ–ò–¢–ò! üí•üíÄ`; leftScore+=5; consecutiveLeft=0;}
    } else {
        startX=rightRect.left;
        endX=leftRect.right+leftRect.width*0.1;
        topY=rightTop;
        rightScore++; consecutiveRight++; consecutiveLeft=0;
        phrase=`${rightNameInput.value||"–ü—Ä–∞–≤—ã–π"}: ${normalPhrases[Math.floor(Math.random()*normalPhrases.length)]}`;
        if(consecutiveRight>=3){ isFatality=true; phrase=`${rightNameInput.value||"–ü—Ä–∞–≤—ã–π"} —Å–æ–≤–µ—Ä—à–∞–µ—Ç –§–ê–¢–ê–õ–ò–¢–ò! üí•üíÄ`; rightScore+=5; consecutiveRight=0;}
    }

    chat.innerHTML+=`<p>${phrase}</p>`; chat.scrollTop=chat.scrollHeight;
    leftScoreDisplay.textContent=`–û—á–∫–∏: ${leftScore}`;
    rightScoreDisplay.textContent=`–û—á–∫–∏: ${rightScore}`;

    handImg.style.top=topY+"px";
    handImg.style.left=startX+"px";
    handImg.style.display="block";

    handImg.animate([
        { transform:"translate(0,-50%) rotate(-45deg) scale(0)" },
        { transform:`translate(${endX-startX}px,-50%) rotate(-45deg) scale(1.2)` },
        { transform:`translate(${endX-startX}px,-50%) rotate(-45deg) scale(1)` }
    ],{duration:400,fill:"forwards"});

    roundActive=false;

    // –ê–≤—Ç–æ-—Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫
    setTimeout(()=>{
        if(roomRef){
            roomRef.update({lastHit:null, roundActive:true});
            roundActive=true;
        }
    },1500);
}

// === –û—Ç–ø—Ä–∞–≤–∫–∞ —É–¥–∞—Ä–∞ ===
leftHit.addEventListener('click',()=>{ roomRef.update({lastHit:"left"}); });
rightHit.addEventListener('click',()=>{ roomRef.update({lastHit:"right"}); });

</script>
</body>
</html>
